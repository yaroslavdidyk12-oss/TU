<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miasto â€” gra planszowa</title>
<link rel="manifest" href="manifest.json">
<style>
body{margin:0;font-family:Arial;background:#1b1b1b;color:#fff}
.board{max-width:420px;margin:auto;padding:15px}
h2{text-align:center;margin-bottom:10px}
.energy{background:#111;padding:12px;text-align:center;font-size:20px;border-radius:8px;margin-bottom:10px}
.phase{text-align:center;margin-bottom:10px;font-weight:bold}
.row{display:flex;justify-content:space-between;align-items:center;background:#2d2d2d;padding:10px;border-radius:6px;margin-bottom:8px}
button{border:none;border-radius:6px;padding:10px;font-size:15px;color:#fff;background:#555}
button:disabled{opacity:.4}
.full{width:100%;margin-bottom:6px}
.green{background:#2e8b57}
.red{background:#8b2e2e}
.orange{background:#b36b00}
.blue{background:#2e5b8b}
.players{display:flex;gap:6px;margin-bottom:10px}
.players button{flex:1}

/* modal */
.modal{position:fixed;top:0;left:0;right:0;bottom:0;
background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:1000}
.modalBox{background:#2b2b2b;padding:20px;border-radius:10px;text-align:center;width:85%}
</style>
</head>

<body>
<div class="board">

<h2>ğŸ™ Taktyczny Urbanista</h2>

<div class="players">
<button class="blue" onclick="setPlayers(1)">1</button>
<button class="blue" onclick="setPlayers(2)">2</button>
<button class="blue" onclick="setPlayers(4)">4</button>
<button class="blue" onclick="setPlayers(6)">6</button>
</div>

<div class="energy">ğŸ”‹ Energia: <span id="energy"></span></div>
<div class="phase" id="phaseText"></div>

<div class="row">
<span>ğŸ­ PrzemysÅ‚: <b id="industry"></b></span>
<button onclick="build('industry',1)">+1</button>
</div>
<div class="row">
<span>âš”ï¸ Wojsko: <b id="army"></b></span>
<button onclick="build('army',5)">+1</button>
</div>
<div class="row">
<span>ğŸ›¡ Obrona: <b id="defense"></b></span>
<button onclick="build('defense',4)">+1</button>
</div>

<div class="row"><span>Symulacja dziaÅ‚aÅ„ sÄ…siada:</span></div>
<div class="row">
  <button class="orange full" onclick="neighborSpy()">ğŸ•µï¸ SÄ…siad uÅ¼ywa Szpiega</button>
</div>
<div class="row">
  <button class="orange full" onclick="neighborAdmiral()">âš“ SÄ…siad uÅ¼ywa AdmiraÅ‚a</button>
</div>

<button class="full green" onclick="drawCard()">ğŸ² Karta zdarzenia</button>
<button class="full red" onclick="nextMinute()">â± NastÄ™pna minuta</button>
<button class="full orange" onclick="resetGame()">ğŸ” Rozpocznij od nowa</button>

</div>

<div class="modal" id="modal">
  <div class="modalBox">
    <p id="modalText"></p>
    <button class="green full" id="yesBtn" onclick="modalYes()">TAK</button>
    <button class="red full" id="noBtn" onclick="modalNo()">NIE</button>
    <button class="full" id="okBtn" onclick="modalOk()">OK</button>
  </div>
</div>

<script>
let energy,industry,army,defense,phase;
let pendingAction=null;
let deck=[],discard=[];
let players=1;
let cardsDrawn=0,maxCards=20;

function setPlayers(n){
 players=n;
 buildDeck();
 resetGame();
}

function buildDeck(){
 deck=[]; discard=[]; cardsDrawn=0;
 let config;
 if(players===1) config={spy:3,admiral:2,disaster:5,crisis:4,sabotage:6};
 else if(players===2) config={spy:4,admiral:3,disaster:5,crisis:3,sabotage:5};
 else if(players===4) config={spy:5,admiral:4,disaster:4,crisis:3,sabotage:4};
 else config={spy:6,admiral:5,disaster:4,crisis:2,sabotage:3};

 for(let k in config) for(let i=0;i<config[k];i++) deck.push(k);
 shuffle(deck);
}

function shuffle(arr){
 for(let i=arr.length-1;i>0;i--){
   const j=Math.floor(Math.random()*(i+1));
   [arr[i],arr[j]]=[arr[j],arr[i]];
 }
}

function drawFromDeck(){
 if(cardsDrawn >= maxCards) return null;
 if(deck.length===0) return null;
 const card = deck.pop();
 discard.push(card);
 cardsDrawn++;
 return card;
}

function resetGame(){
 energy=1; industry=0; army=0; defense=0; phase=0;
 buildDeck();
 update();
}

function update(){
 if(energy>8) energy=8;
 if(energy===0 && industry===0) energy=1;
 document.getElementById("energy").innerText=energy;
 document.getElementById("industry").innerText=industry;
 document.getElementById("army").innerText=army;
 document.getElementById("defense").innerText=defense;
 document.getElementById("phaseText").innerText=
  phase===0?"Faza: ğŸƒ Karta zdarzenia":"Faza: ğŸ— Budowa";
}

function showModal(text,mode,yesAction){
 document.getElementById("modalText").innerText=text;
 pendingAction=yesAction;
 document.getElementById("yesBtn").style.display=mode==="choice"?"block":"none";
 document.getElementById("noBtn").style.display=mode==="choice"?"block":"none";
 document.getElementById("okBtn").style.display=mode==="info"?"block":"none";
 document.getElementById("modal").style.display="flex";
}

function modalYes(){ if(pendingAction) pendingAction(); closeModal(); }
function modalNo(){ closeModal(); }
function modalOk(){ closeModal(); }

function closeModal(){
 pendingAction=null;
 document.getElementById("modal").style.display="none";
 phase=1;
 update();
}

function drawCard(){
 if(phase!==0) return;
 const type = drawFromDeck();
 if(!type){
   showModal("ğŸ›‘ Wszystkie karty wykorzystane.","info");
   return;
 }

 if(type==="spy"){
   showModal("ğŸ•µï¸ Szpieg\nZapÅ‚aciÄ‡ 2 energii?", "choice",
     ()=>{ if(energy>=2) energy-=2; });
 }
 else if(type==="admiral"){
   showModal("âš“ AdmiraÅ‚\nZapÅ‚aciÄ‡ 6 energii?", "choice",
     ()=>{ if(energy>=6) energy-=6; });
 }
 else if(type==="disaster"){
   if(industry>0) industry--;
   showModal("ğŸŒª Katastrofa naturalna\nUtracono 1 jednostkÄ™ przemysÅ‚u.","info");
 }
 else if(type==="crisis"){
   energy=0;
   showModal("ğŸ“‰ Kryzys ekonomiczny\nUtracono caÅ‚Ä… energiÄ™.","info");
 }
 else if(type==="sabotage"){
   if(defense>0){
     defense--;
     showModal("ğŸ’£ SabotaÅ¼\nUtracono 1 jednostkÄ™ obrony.","info");
   } else {
     let lost = Math.min(2, industry);
     if(lost >= industry && energy===0 && industry-lost===0) lost = industry-1;
     if(lost<0) lost=0;
     industry -= lost;
     showModal(`ğŸ’£ SabotaÅ¼\nUtracono ${lost} jednostki przemysÅ‚u.`,"info");
   }
 }
 update();
}

function build(type,cost){
 if(phase!==1 || energy<cost) return;
 energy-=cost;
 if(type==="industry")industry++;
 if(type==="army")army++;
 if(type==="defense")defense++;
 update();
}

function nextMinute(){
 if(phase!==1) return;
 energy+=industry;
 phase=0;
 update();
}

// Symulacja dziaÅ‚aÅ„ sÄ…siada
function neighborSpy(){
  if(defense>0){
    defense--;
    showModal("ğŸ•µï¸ SÄ…siad uÅ¼yÅ‚ Szpiega\nUtracono 1 jednostkÄ™ obrony","info");
  } else if(industry>1 || energy>0){
    let lost = (energy>0)? industry : Math.min(2,industry);
    industry -= lost;
    showModal(`ğŸ•µï¸ SÄ…siad uÅ¼yÅ‚ Szpiega\nUtracono ${lost} jednostki przemysÅ‚u`,"info");
  } else {
    showModal("ğŸ•µï¸ SÄ…siad uÅ¼yÅ‚ Szpiega\nNie ma strat","info");
  }
  update();
}

function neighborAdmiral(){
  if(army>0){
    army--;
    showModal("âš“ SÄ…siad uÅ¼yÅ‚ AdmiraÅ‚a\nUtracono 1 jednostkÄ™ wojska","info");
  } else if(industry>1 || energy>0){
    let lost = (energy>0)? industry : Math.min(2,industry);
    industry -= lost;
    showModal(`âš“ SÄ…siad uÅ¼yÅ‚ AdmiraÅ‚a\nUtracono ${lost} jednostki przemysÅ‚u`,"info");
  } else {
    showModal("âš“ SÄ…siad uÅ¼yÅ‚ AdmiraÅ‚a\nNie ma strat","info");
  }
  update();
}

if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}

setPlayers(1);
</script>
</body>
</html>
