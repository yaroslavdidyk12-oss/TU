<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú—ñ—Å—Ç–æ ‚Äî –Ω–∞—Å—Ç—ñ–ª—å–Ω–∞ –≥—Ä–∞</title>
<link rel="manifest" href="manifest.json">
<style>
body{margin:0;font-family:Arial;background:#1b1b1b;color:#fff}
.board{max-width:420px;margin:auto;padding:15px}
h2{text-align:center;margin-bottom:10px}
.energy{background:#111;padding:12px;text-align:center;font-size:20px;border-radius:8px;margin-bottom:10px}
.phase{text-align:center;margin-bottom:10px;font-weight:bold}
.row{display:flex;justify-content:space-between;align-items:center;background:#2d2d2d;padding:10px;border-radius:6px;margin-bottom:8px}
button{border:none;border-radius:6px;padding:10px;font-size:15px;color:#fff;background:#555}
button:disabled{opacity:.4}
.full{width:100%;margin-bottom:6px}
.green{background:#2e8b57}
.red{background:#8b2e2e}
.orange{background:#b36b00}
.blue{background:#2e5b8b}
.players{display:flex;gap:6px;margin-bottom:10px}
.players button{flex:1}

/* modal */
.modal{position:fixed;top:0;left:0;right:0;bottom:0;
background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:1000}
.modalBox{background:#2b2b2b;padding:20px;border-radius:10px;text-align:center;width:85%}
</style>
</head>

<body>
<div class="board">

<h2>üèô –¢–∞–∫—Ç–∏—á–Ω–∏–π —É—Ä–±–∞–Ω—ñ—Å—Ç</h2>

<div class="players">
<button class="blue" onclick="setPlayers(1)">1</button>
<button class="blue" onclick="setPlayers(2)">2</button>
<button class="blue" onclick="setPlayers(4)">4</button>
<button class="blue" onclick="setPlayers(6)">6</button>
</div>

<div class="energy">üîã –ï–Ω–µ—Ä–≥—ñ—è: <span id="energy"></span></div>
<div class="phase" id="phaseText"></div>

<div class="row">
<span>üè≠ –ü—Ä–æ–º–∏—Å–ª–æ–≤—ñ—Å—Ç—å: <b id="industry"></b></span>
<button onclick="build('industry',1)">+1</button>
</div>
<div class="row">
<span>‚öîÔ∏è –í—ñ–π—Å—å–∫–æ: <b id="army"></b></span>
<button onclick="build('army',5)">+1</button>
</div>
<div class="row">
<span>üõ° –û–±–æ—Ä–æ–Ω–∞: <b id="defense"></b></span>
<button onclick="build('defense',4)">+1</button>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Å–∏–º—É–ª—è—Ü—ñ—ó —Å—É—Å—ñ–¥–∞ -->
<div class="row"><span>–°–∏–º—É–ª—è—Ü—ñ—è –¥—ñ–π —Å—É—Å—ñ–¥–∞:</span></div>
<div class="row">
  <button class="orange full" onclick="neighborSpy()">üïµÔ∏è –°—É—Å—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –®–ø–∏–≥—É–Ω</button>
</div>
<div class="row">
  <button class="orange full" onclick="neighborAdmiral()">‚öì –°—É—Å—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ê–¥–º—ñ—Ä–∞–ª–∞</button>
</div>

<button class="full green" onclick="drawCard()">üé≤ –ö–∞—Ä—Ç–∞ –ø–æ–¥—ñ—ó</button>
<button class="full red" onclick="nextMinute()">‚è± –ù–∞—Å—Ç—É–ø–Ω–∞ —Ö–≤–∏–ª–∏–Ω–∞</button>
<button class="full orange" onclick="resetGame()">üîÅ –ü–æ—á–∞—Ç–∏ –∑ –ø–æ—á–∞—Ç–∫—É</button>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modalBox">
    <p id="modalText"></p>
    <button class="green full" id="yesBtn" onclick="modalYes()">–¢–ê–ö</button>
    <button class="red full" id="noBtn" onclick="modalNo()">–ù–Ü</button>
    <button class="full" id="okBtn" onclick="modalOk()">OK</button>
  </div>
</div>

<script>
let energy,industry,army,defense,phase;
let pendingAction=null;
let deck=[],discard=[];
let players=1;
let cardsDrawn=0,maxCards=20;

function setPlayers(n){
 players=n;
 buildDeck();
 resetGame();
}

function buildDeck(){
 deck=[]; discard=[]; cardsDrawn=0;
 let config;
 if(players===1) config={spy:3,admiral:2,disaster:5,crisis:4,sabotage:6};
 else if(players===2) config={spy:4,admiral:3,disaster:5,crisis:3,sabotage:5};
 else if(players===4) config={spy:5,admiral:4,disaster:4,crisis:3,sabotage:4};
 else config={spy:6,admiral:5,disaster:4,crisis:2,sabotage:3};

 for(let k in config) for(let i=0;i<config[k];i++) deck.push(k);

 shuffle(deck);
}

function shuffle(arr){
 for(let i=arr.length-1;i>0;i--){
   const j=Math.floor(Math.random()*(i+1));
   [arr[i],arr[j]]=[arr[j],arr[i]];
 }
}

function drawFromDeck(){
 if(cardsDrawn >= maxCards) return null;
 if(deck.length===0) return null;
 const card = deck.pop();
 discard.push(card);
 cardsDrawn++;
 return card;
}

function resetGame(){
 energy=1; industry=0; army=0; defense=0; phase=0;
 buildDeck(); // –ø–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç
 update();
}

function update(){
 if(energy>8) energy=8;
 if(energy===0 && industry===0) energy=1;

 document.getElementById("energy").innerText=energy;
 document.getElementById("industry").innerText=industry;
 document.getElementById("army").innerText=army;
 document.getElementById("defense").innerText=defense;
 document.getElementById("phaseText").innerText=
  phase===0?"–§–∞–∑–∞: üÉè –ö–∞—Ä—Ç–∞ –ø–æ–¥—ñ—ó":"–§–∞–∑–∞: üèó –ë—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–æ";
}

function showModal(text,mode,yesAction){
 document.getElementById("modalText").innerText=text;
 pendingAction=yesAction;

 document.getElementById("yesBtn").style.display=mode==="choice"?"block":"none";
 document.getElementById("noBtn").style.display=mode==="choice"?"block":"none";
 document.getElementById("okBtn").style.display=mode==="info"?"block":"none";

 document.getElementById("modal").style.display="flex";
}

function modalYes(){ if(pendingAction) pendingAction(); closeModal(); }
function modalNo(){ closeModal(); }
function modalOk(){ closeModal(); }

function closeModal(){
 pendingAction=null;
 document.getElementById("modal").style.display="none";
 phase=1;
 update();
}

function drawCard(){
 if(phase!==0) return;
 const type = drawFromDeck();
 if(!type){
   showModal("üõë –í—Å—ñ –∫–∞—Ä—Ç–∏ –≤–∏—Ç—Ä–∞—á–µ–Ω—ñ. –ö—ñ–Ω–µ—Ü—å –∫–æ–ª–æ–¥–∏.","info");
   return;
 }

 if(type==="spy"){
   showModal("üïµÔ∏è –®–ø–∏–≥—É–Ω\n–ó–∞–ø–ª–∞—Ç–∏—Ç–∏ 2 –µ–Ω–µ—Ä–≥—ñ—ó?", "choice",
     ()=>{ if(energy>=2) energy-=2; });
 }
 else if(type==="admiral"){
   showModal("‚öì –ê–¥–º—ñ—Ä–∞–ª\n–ó–∞–ø–ª–∞—Ç–∏—Ç–∏ 6 –µ–Ω–µ—Ä–≥—ñ—ó?", "choice",
     ()=>{ if(energy>=6) energy-=6; });
 }
 else if(type==="disaster"){
   if(industry>0) industry--;
   showModal("üå™ –°—Ç–∏—Ö—ñ–π–Ω–µ –ª–∏—Ö–æ\n–í—Ç—Ä–∞—á–µ–Ω–æ 1 –æ–¥–∏–Ω–∏—Ü—é –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ—Å—Ç—ñ.","info");
 }
 else if(type==="crisis"){
   energy=0;
   showModal("üìâ –ï–∫–æ–Ω–æ–º—ñ—á–Ω–∞ –∫—Ä–∏–∑–∞\n–í—Ç—Ä–∞—á–µ–Ω–æ –≤—Å—é –µ–Ω–µ—Ä–≥—ñ—é.","info");
 }
 else if(type==="sabotage"){
   if(defense>0){
     defense--;
     showModal("üí£ –î–∏–≤–µ—Ä—Å—ñ—è\n–í—Ç—Ä–∞—á–µ–Ω–æ 1 –æ–¥–∏–Ω–∏—Ü—é –æ–±–æ—Ä–æ–Ω–∏.","info");
   } else {
     let lost = Math.min(2, industry);
     if(lost >= industry && energy===0 && industry-lost===0) lost = industry-1;
     if(lost<0) lost=0;
     industry -= lost;
     showModal(`üí£ –î–∏–≤–µ—Ä—Å—ñ—è\n–í—Ç—Ä–∞—á–µ–Ω–æ ${lost} –æ–¥–∏–Ω–∏—Ü—ñ(–∏) –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ—Å—Ç—ñ.`,"info");
   }
 }
 update();
}

function build(type,cost){
 if(phase!==1 || energy<cost) return;
 energy-=cost;
 if(type==="industry")industry++;
 if(type==="army")army++;
 if(type==="defense")defense++;
 update();
}

function nextMinute(){
 if(phase!==1) return;
 energy+=industry;
 phase=0;
 update();
}

// –°–∏–º—É–ª—è—Ü—ñ—è –¥—ñ–π —Å—É—Å—ñ–¥–∞
function neighborSpy(){
  if(industry > 0){
    industry--;
    showModal("üïµÔ∏è –°—É—Å—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ –®–ø–∏–≥—É–Ω–∞\n–í—Ç—Ä–∞—Ç–∞ 1 –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ—Å—Ç—ñ","info");
  } else {
    showModal("üïµÔ∏è –°—É—Å—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ –®–ø–∏–≥—É–Ω–∞\n–ü—Ä–æ–º–∏—Å–ª–æ–≤–æ—Å—Ç—ñ –Ω–µ–º–∞—î, –≤—Ç—Ä–∞—Ç –Ω–µ–º–∞—î","info");
  }
  update();
}

function neighborAdmiral(){
  if(army > 0){
    army--;
    showModal("‚öì –°—É—Å—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ –ê–¥–º—ñ—Ä–∞–ª–∞\n–í—Ç—Ä–∞—Ç–∞ 1 –æ–¥–∏–Ω–∏—Ü—ñ –≤—ñ–π—Å—å–∫–∞","info");
  } else if(industry>0){
    industry--;
    showModal("‚öì –°—É—Å—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ –ê–¥–º—ñ—Ä–∞–ª–∞\n–í—ñ–π—Å—å–∫–æ –≤—ñ–¥—Å—É—Ç–Ω—î, –≤—Ç—Ä–∞—á–µ–Ω–æ 1 –ø—Ä–æ–º–∏—Å–ª–æ–≤—ñ—Å—Ç—å","info");
  } else {
    showModal("‚öì –°—É—Å—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ –ê–¥–º—ñ—Ä–∞–ª–∞\n–ù–µ–º–∞—î –≤—ñ–π—Å—å–∫ —ñ –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ—Å—Ç—ñ, –≤—Ç—Ä–∞—Ç –Ω–µ–º–∞—î","info");
  }
  update();
}

if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}

setPlayers(1);
</script>
</body>
</html>
